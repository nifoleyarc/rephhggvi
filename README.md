# üé¨ –ê—Ä—Ö–∏–≤ —Å—Ç—Ä–∏–º–æ–≤ GENSYXA

**Telegram Mini App –¥–ª—è –∞—Ä—Ö–∏–≤–∞ —Å—Ç—Ä–∏–º–æ–≤** - –ø–æ–ª–Ω–æ—Å—Ç—å—é –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä!

## üöÄ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

–ü—Ä–æ–µ–∫—Ç **–ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω** –∏ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω:
- **‚ùå Vercel** ‚Üí **‚úÖ Ubuntu —Å–µ—Ä–≤–µ—Ä**
- **‚ùå MongoDB** ‚Üí **‚úÖ SQLite** 
- **‚ùå Cloudinary** ‚Üí **‚úÖ S3 cloud.ru**

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å, –Ω–æ —Ç–µ–ø–µ—Ä—å –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ!

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ server.js                  # –ì–ª–∞–≤–Ω—ã–π —Å–µ—Ä–≤–µ—Ä Express.js
‚îú‚îÄ‚îÄ server/                    # –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å
‚îÇ   ‚îú‚îÄ‚îÄ database/init.js       # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite
‚îÇ   ‚îú‚îÄ‚îÄ routes/               # API endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ streams.js        # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∏–º–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ categories.js     # –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js          # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ webhook.js       # Telegram webhook
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ thumbnails.js    # –ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ utils/               # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ       ‚îú‚îÄ‚îÄ s3.js           # –†–∞–±–æ—Ç–∞ —Å S3 cloud.ru
‚îÇ       ‚îî‚îÄ‚îÄ thumbnailGenerator.js # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–≤—å—é
‚îú‚îÄ‚îÄ src/                      # React —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
‚îú‚îÄ‚îÄ scripts/                  # –°–∫—Ä–∏–ø—Ç—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îú‚îÄ‚îÄ database.sqlite          # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îî‚îÄ‚îÄ dist/                    # –°–æ–±—Ä–∞–Ω–Ω—ã–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:

```bash
# Telegram Bot
TELEGRAM_BOT_TOKEN="–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞"
TELEGRAM_CHANNEL_USERNAME="@–≤–∞—à_–∫–∞–Ω–∞–ª"
ADMIN_USER_ID="–≤–∞—à_telegram_id"
EDITOR_PASSWORD_HASH="—Ö–µ—à_–ø–∞—Ä–æ–ª—è"

# S3 cloud.ru –¥–ª—è –ø—Ä–µ–≤—å—é
S3_ACCESS_KEY_ID="–≤–∞—à_access_key"
S3_SECRET_ACCESS_KEY="–≤–∞—à_secret_key"
S3_BUCKET_NAME="bucket-817022"
S3_TENANT_ID="39d7ef97-9d7b-402b-83a9-cdc5a1bda6f4"

# –°–µ—Ä–≤–µ—Ä
PORT=3000
NODE_ENV=production
FRONTEND_URL="http://localhost:3000"

# Webhook (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
WEBHOOK_SECRET="—Å–µ–∫—Ä–µ—Ç–Ω—ã–π_–∫–ª—é—á"
WEBAPP_URL="https://–≤–∞—à-–¥–æ–º–µ–Ω.com"
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
npm install
```

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:

```bash
npm run setup:database
```

### 4. –ü–µ—Ä–µ–Ω–µ—Å–∏—Ç–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –≤ S3 (–µ—Å–ª–∏ –µ—Å—Ç—å —Å—Ç–∞—Ä—ã–µ):

```bash
npm run migrate:images
```

### 5. –°–æ–±–µ—Ä–∏—Ç–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
npm run build
npm start
```

### 6. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Telegram webhook:

```bash
npm run setup:webhook
```

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `npm start` | –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ (–ø—Ä–æ–¥–∞–∫—à–Ω) |
| `npm run start:dev` | –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ |
| `npm run build` | –°–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ |
| `npm run setup:database` | –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö |
| `npm run migrate:images` | –ú–∏–≥—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–æ–∫ –≤ S3 |
| `npm run upload:frontend` | –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –≤ S3 |
| `npm run setup:webhook` | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram webhook |

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `npm run setup:password` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ö–µ—à–∞ –ø–∞—Ä–æ–ª—è |
| `npm run setup:admin` | –ü–æ–ª—É—á–µ–Ω–∏–µ Telegram ID |
| `npm run check:webhook` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ webhook |
| `npm run diagnose:webhook` | –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º |

## üöÄ –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PM2 –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏:

```bash
npm install -g pm2
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ PM2:

```bash
pm2 start server.js --name "vod-archive"
pm2 startup
pm2 save
```

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ nginx (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

## üì± –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥** –ø–æ—Å—Ç–æ–≤ –∏–∑ Telegram –∫–∞–Ω–∞–ª–∞
- **–ü—Ä–µ–≤—å—é —Å—Ç—Ä–∏–º–æ–≤** —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
- **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏** –ø–æ —Ç–µ–≥–∞–º –≤ –ø–æ—Å—Ç–∞—Ö
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω–∞** —á–µ—Ä–µ–∑ Telegram –∏–ª–∏ –ø–∞—Ä–æ–ª—å
- **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∏–º–æ–≤** –≤—Ä—É—á–Ω—É—é
- **Responsive –¥–∏–∑–∞–π–Ω** –¥–ª—è –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- **–ó–∞—â–∏—Ç–∞ –æ—Ç –≤–∑–ª–æ–º–∞** (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞)

### üîÑ –ê–≤—Ç–æ–ø–∞—Ä—Å–µ—Ä:
–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ—Å—Ç—ã –∏–∑ –∫–∞–Ω–∞–ª–∞ –µ—Å–ª–∏ –æ–Ω–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç:
- **–¢–µ–≥–∏** (–Ω–∞–ø—Ä–∏–º–µ—Ä: `#just_chatting`, `#–∏–≥—Ä—ã`, `#—Ñ–∏–ª—å–º`)
- **–î–∞—Ç—É** –≤ —Ñ–æ—Ä–º–∞—Ç–µ `DD.MM.YYYY` –∏–ª–∏ `DD.MM.YY`
- **–ü—Ä–µ–≤—å—é** –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏:
- –û–±—â–µ–Ω–∏–µ / –í–∏–¥–æ—Å—ã
- –ò–†–õ —Å—Ç—Ä–∏–º—ã  
- –§–∏–ª—å–º—ã / –ú—É–ª—å—Ç–∏–∫–∏
- –ò–≥—Ä–æ–≤—ã–µ —Å—Ç—Ä–∏–º—ã
- –ö–æ–Ω—Ç–µ–Ω—Ç
- –ú–∞—Ä–∞—Ñ–æ–Ω—ã
- –ö—É–∫–∏–Ω–≥–∏
- –®–û–£

## üîó API Endpoints

| Endpoint | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-------|----------|
| `/api/streams` | GET | –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–∏–º–æ–≤ |
| `/api/streams` | POST | –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å—Ç—Ä–∏–º |
| `/api/streams/:id` | PUT | –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∏–º |
| `/api/streams/:id` | DELETE | –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–∏–º |
| `/api/categories` | GET | –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π |
| `/api/auth` | POST | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
| `/api/webhook` | POST | Telegram webhook |
| `/api/refresh-thumbnail` | POST | –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–≤—å—é |

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

**streams** - —Å—Ç—Ä–∏–º—ã
- id, title, telegram_url, stream_date
- tags (JSON), categories (JSON)  
- thumbnail_url, thumbnail_s3_key
- created_at, updated_at

**categories** - –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- id, name, tag, description

**auth_attempts** - –∑–∞—â–∏—Ç–∞ –æ—Ç –≤–∑–ª–æ–º–∞
- ip, attempts, banned_until

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏**: `pm2 logs vod-archive`
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook**: `npm run check:webhook`  
3. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**: `npm run diagnose:webhook`
4. **–ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É**: `npm run setup:database`

## üéâ –ì–æ—Ç–æ–≤–æ!

–í–∞—à –∞—Ä—Ö–∏–≤ —Å—Ç—Ä–∏–º–æ–≤ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ —Å SQLite –∏ S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º. –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã, –Ω–æ —Ç–µ–ø–µ—Ä—å –≤—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É! 