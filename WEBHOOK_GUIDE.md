# ü§ñ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–±–æ—Ç–µ —Å Telegram Webhook

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å Telegram webhook –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –ø–æ—Å—Ç–æ–≤ –∫–∞–Ω–∞–ª–∞.

## üìã –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –û–±–Ω–æ–≤–∏—Ç—å webhook –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π:
```bash
npm run webhook:update
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å webhook:
```bash
npm run webhook:status
```

### –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ webhook:
```bash
npm run webhook:diagnostic
```

### –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–æ–±–Ω–æ–≤–∏—Ç—å + –ø—Ä–æ–≤–µ—Ä–∏—Ç—å + –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å):
```bash
npm run webhook:full
```

## üîß –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `npm run webhook:update` | –û–±–Ω–æ–≤–∏—Ç—å webhook —Å —Ç–µ–∫—É—â–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ |
| `npm run webhook:status` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å webhook |
| `npm run webhook:delete` | –£–¥–∞–ª–∏—Ç—å webhook |
| `npm run webhook:test` | –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å webhook |
| `npm run webhook:full` | –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–æ–±–Ω–æ–≤–∏—Ç—å + –ø—Ä–æ–≤–µ—Ä–∏—Ç—å + –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å) |
| `npm run webhook:diagnostic` | –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ |

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ —Ñ–∞–π–ª–µ `.env` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```env
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
TELEGRAM_BOT_TOKEN=your_bot_token_here
WEBHOOK_URL=https://yourdomain.com/api/webhook

# –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ
WEBHOOK_SECRET=your_secret_token_here
TELEGRAM_CHANNEL_USERNAME=your_channel_name

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ
MINI_APP_URL=https://your-mini-app.com
```

### –ì–¥–µ –≤–∑—è—Ç—å TELEGRAM_BOT_TOKEN:
1. –ù–∞–π–¥–∏—Ç–µ @BotFather –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –±–æ—Ç
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –≤–∏–¥–∞: `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`

### –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å WEBHOOK_URL:
- –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: `http://localhost:3000/api/webhook`
- –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞: `https://yourdomain.com/api/webhook`
- –î–ª—è Vercel: `https://your-app.vercel.app/api/webhook`

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### 1. Webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```bash
npm run webhook:diagnostic
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –±–æ—Ç–∞
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ webhook
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å webhook URL
- ‚úÖ –ü—Ä–∞–≤–∞ –±–æ—Ç–∞ –≤ –∫–∞–Ω–∞–ª–µ

### 2. –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

#### –ü—Ä–æ–±–ª–µ–º–∞: "Webhook –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
**–†–µ—à–µ–Ω–∏–µ:**
```bash
npm run webhook:update
```

#### –ü—Ä–æ–±–ª–µ–º–∞: "channel_post –Ω–µ –≤–∫–ª—é—á–µ–Ω –≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"
**–†–µ—à–µ–Ω–∏–µ:**
```bash
npm run webhook:update
```

#### –ü—Ä–æ–±–ª–µ–º–∞: "Webhook URL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- –°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL
- –ü—Ä–æ–±–ª–µ–º—ã —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ñ–∞–π—Ä–≤–æ–ª–æ–º

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å WEBHOOK_URL
3. –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS

#### –ü—Ä–æ–±–ª–µ–º–∞: "–ë–æ—Ç –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∫–∞–Ω–∞–ª–∞"
**–†–µ—à–µ–Ω–∏–µ:**
1. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –∫–∞–Ω–∞–ª –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
2. –î–∞–π—Ç–µ –ø—Ä–∞–≤–∞ "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏"
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ TELEGRAM_CHANNEL_USERNAME —É–∫–∞–∑–∞–Ω –ë–ï–ó —Å–∏–º–≤–æ–ª–∞ @

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ webhook

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook, –ø–æ—Å—Ç—ã –∫–∞–Ω–∞–ª–∞ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm run start:dev

# –ü—Ä–æ–¥–∞–∫—à–µ–Ω (Vercel)
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Vercel Dashboard ‚Üí Functions ‚Üí webhook.js
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
npm run webhook:status
```

–í—ã —É–≤–∏–¥–∏—Ç–µ:
- URL webhook
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–∂–∏–¥–∞—é—â–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏
- –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç webhook
```bash
npm run webhook:test
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å webhook URL
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Telegram API
- –ü–æ–∫–∞–∂–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ

### –¢–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º –ø–æ—Å—Ç–æ–º
1. –û–ø—É–±–ª–∏–∫—É–π—Ç–µ –ø–æ—Å—Ç –≤ –∫–∞–Ω–∞–ª–µ —Å —Ç–µ–≥–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `#just_chatting`)
2. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 30 —Å–µ–∫—É–Ω–¥
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–æ–≤–æ–≥–æ —Å—Ç—Ä–∏–º–∞

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ webhook

### –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ URL
–ï—Å–ª–∏ –≤—ã –∏–∑–º–µ–Ω–∏–ª–∏ –¥–æ–º–µ–Ω –∏–ª–∏ –ø—É—Ç—å webhook:

1. –û–±–Ω–æ–≤–∏—Ç–µ WEBHOOK_URL –≤ .env
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ:
```bash
npm run webhook:update
```

### –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã webhook (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω):

1. –û–±–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ .env
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ:
```bash
npm run webhook:full
```

## üõ†Ô∏è –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook —á–µ—Ä–µ–∑ API
```bash
curl -X POST "https://api.telegram.org/bot{YOUR_BOT_TOKEN}/setWebhook" \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://yourdomain.com/api/webhook",
    "allowed_updates": ["channel_post"],
    "max_connections": 40
  }'
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ webhook
```bash
curl "https://api.telegram.org/bot{YOUR_BOT_TOKEN}/getWebhookInfo"
```

### –£–¥–∞–ª–µ–Ω–∏–µ webhook
```bash
curl -X POST "https://api.telegram.org/bot{YOUR_BOT_TOKEN}/deleteWebhook"
```

## üìù –õ–æ–≥–∏ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –í–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –ª–æ–≥–æ–≤
–í —Ñ–∞–π–ª–µ `server/routes/webhook.js` —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

```javascript
console.log('üì® –ü–æ–ª—É—á–µ–Ω webhook –æ—Ç Telegram')
console.log('üìã –¢–∏–ø –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', Object.keys(update).join(', '))
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- **Vercel**: Dashboard ‚Üí Functions ‚Üí webhook.js ‚Üí Logs
- **Heroku**: `heroku logs --tail`
- **–î—Ä—É–≥–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ª–æ–≥–∏

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ WEBHOOK_SECRET** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS** –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
3. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø** –∫ webhook endpoint
4. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞:
```env
WEBHOOK_SECRET=your_random_secret_here
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É: `npm run webhook:diagnostic`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –≤ –∫–∞–Ω–∞–ª–µ

### –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:
- [Telegram Bot API Documentation](https://core.telegram.org/bots/api)
- [Webhook Guide](https://core.telegram.org/bots/webhooks)
- [BotFather Commands](https://core.telegram.org/bots#botfather-commands) 